/*! @name @brightcove/react-player-loader @version 1.4.2 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("global/document"),require("global/window")):"function"==typeof define&&define.amd?define(["react","global/document","global/window"],t):(e=e||self).BrightcoveReactPlayerLoader=t(e.React,e.document,e.window)}(this,function(e,t,r){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}
/*! @name @brightcove/player-loader @version 1.8.0 @license Apache-2.0 */
function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=["catalogSearch","catalogSequence"],s=["adConfigId","applicationId","catalogSearch","catalogSequence","playlistId","playlistVideoId","videoId"],l=function(e){return Object.keys(e).filter(function(e){return-1!==s.indexOf(e)}).reduce(function(t,r){var n=function(e,t){if(e&&void 0!==e[t]){if("string"!=typeof e[t]&&-1!==a.indexOf(t))try{return encodeURIComponent(JSON.stringify(e[t]))}catch(e){return}return encodeURIComponent(String(e[t]).trim())||void 0}}(e,r);return void 0!==n&&(t+=t?"&":"?",t+=encodeURIComponent(r)+"="+n),t},"")},d=function(e){var t=e.accountId,r=e.base,n=void 0===r?"https://players.brightcove.net":r,o=e.playerId,a=void 0===o?"default":o,s=e.embedId,d=void 0===s?"default":s,c=e.iframe,p=void 0!==c&&c,u=e.minified,f=void 0===u||u,y=e.queryParams,h=void 0===y?null:y,m="";p?m+="html":(f&&(m+="min."),m+="js"),"/"===n.charAt(n.length-1)&&(n=n.substring(0,n.length-1));var v="";return p&&h&&"object"===(void 0===h?"undefined":i(h))&&(v=l(h)),n+"/"+(t=encodeURIComponent(t))+"/"+(a=encodeURIComponent(a))+"_"+(d=encodeURIComponent(d))+"/index."+m+v};
/*! @name @brightcove/player-url @version 1.2.0 @license Apache-2.0 */d.VERSION="1.2.0";var c={embedId:"default",embedType:"in-page",playerId:"default",Promise:r.Promise,refNodeInsert:"append"},p="video",u="video-js",f="in-page",y="iframe",h="append",m="prepend",v="before",b="after",g="replace",I=["catalogSearch","catalogSequence"],E="https://players.brightcove.net/",N=function(e){if(e.playerUrl)return e.playerUrl;var t=e.accountId,r=e.playerId,n=e.embedId,o=e.embedOptions,i=e.embedType===y;return d({accountId:t,playerId:r,embedId:n,iframe:i,base:E,minified:!o||!o.unminified,queryParams:e})},P=function(){return E},O=function(e){E=e},_=function(e){return Boolean(e&&1===e.nodeType)},w=function(e){return Boolean(_(e)&&e.parentNode)},S=function(e,r,n){return r?function(e,r){if(!e.pip)return r;var n=t.createElement("div");return n.classList.add("vjs-pip-container"),n.appendChild(r),n}(r,function(e,r,n){if(!r.responsive)return n;n.style.position="absolute",n.style.top="0px",n.style.right="0px",n.style.bottom="0px",n.style.left="0px",n.style.width="100%",n.style.height="100%";var i=o({aspectRatio:"16:9",iframeHorizontalPlaylist:!1,maxWidth:"100%"},r.responsive),a=i.aspectRatio.split(":").map(Number),s=t.createElement("div"),l=a[1]/a[0]*100;e===y&&i.iframeHorizontalPlaylist&&(l*=1.25),s.style.paddingTop=l+"%",s.appendChild(n);var d=t.createElement("div");return d.style.position="relative",d.style.display="block",d.style.maxWidth=i.maxWidth,d.appendChild(s),d}(e,r,n)):n},R=function(e){return function(e,r){var n=e.refNode,o=e.refNodeInsert,i=n.parentNode,a=S(e.embedType,e.embedOptions,r);if(o===v?i.insertBefore(a,n):o===b?i.insertBefore(a,n.nextElementSibling||null):o===g?i.replaceChild(a,n):o===m?n.insertBefore(a,n.firstChild||null):n.appendChild(a),e.embedOptions&&e.embedOptions.playlist){var s=e.embedOptions.playlist.legacy?"ul":"div",l=t.createElement(s);l.classList.add("vjs-playlist"),r.parentNode.insertBefore(l,r.nextElementSibling||null)}return e.refNode=null,r}(e,function(e,t){if("function"!=typeof e.onEmbedCreated)return t;var r=e.onEmbedCreated(t);return _(r)?r:t}(e,e.embedType===y?function(e){var r=t.createElement("iframe");return r.setAttribute("allow","autoplay;encrypted-media;fullscreen"),r.setAttribute("allowfullscreen","allowfullscreen"),r.src=N(e),r}(e):function(e){var r=e.embedOptions,n={adConfigId:"data-ad-config-id",applicationId:"data-application-id",catalogSearch:"data-catalog-search",catalogSequence:"data-catalog-sequence",deliveryConfigId:"data-delivery-config-id",playlistId:"data-playlist-id",playlistVideoId:"data-playlist-video-id",poster:"poster",videoId:"data-video-id"},o=r&&r.tagName||u,i=t.createElement(o);return Object.keys(n).filter(function(t){return e[t]}).forEach(function(t){var r;if("string"!=typeof e[t]&&-1!==I.indexOf(t))try{r=JSON.stringify(e[t])}catch(e){return}else r=String(e[t]).trim();i.setAttribute(n[t],r)}),i.setAttribute("controls","controls"),i.classList.add("video-js"),i}(e)))},C=new r.Map,A=function(e){return(e.accountId||"*")+"_"+e.playerId+"_"+e.embedId},j=function(){C.clear()},q=function(e){C.forEach(e)},x=function(e){return C.has(A(e))},T=function(e){C.set(A(e),e.accountId?N(e):"")},U=/^([A-Za-z0-9]+)_([A-Za-z0-9]+)$/,B=function(){return r.bc?Object.keys(r.bc).filter(function(e){return U.test(e)}):[]},D=function(e){e&&Object.keys(e.players).forEach(function(t){var r=e.players[t];r&&r.dispose()})},k=function(){q(function(e,r){e&&Array.prototype.slice.call(t.querySelectorAll('script[src="'+e+'"]')).forEach(function(e){return e.parentNode.removeChild(e)})}),j(),D(r.videojs),B().forEach(function(e){return D(r.bc[e].videojs)}),Object.keys(r).filter(function(e){return/^videojs/i.test(e)||/^(bc)$/.test(e)}).forEach(function(e){delete r[e]})};(function(){B().forEach(function(e){var t=e.match(U),r={playerId:t[1],embedId:t[2]};x(r)||T(r)})})();var M=function(e){return"function"==typeof e},V=function(e){var t,r=e.accountId,n=e.embedOptions,o=e.embedType,i=e.options,a=e.refNode,s=e.refNodeInsert;if(!r)throw new Error("accountId is required");if(!w(a))throw new Error("refNode must resolve to a node attached to the DOM");if(!function(e){return e===f||e===y}(o))throw new Error("embedType is missing or invalid");if(o===y&&i)throw new Error("cannot use options with an iframe embed");if(n&&void 0!==n.tagName&&((t=n.tagName)!==u&&t!==p))throw new Error('embedOptions.tagName is invalid (value: "'+n.tagName+'")');if(n&&n.responsive&&n.responsive.aspectRatio&&!/^\d+\:\d+$/.test(n.responsive.aspectRatio))throw new Error('embedOptions.responsive.aspectRatio must be in the "n:n" format (value: "'+n.responsive.aspectRatio+'")');if(!function(e){return e===h||e===m||e===v||e===b||e===g}(s))throw new Error("refNodeInsert is missing or invalid")},F=function(e,t,n,o){var i,a=e.embedId,s=e.playerId,l=r.bc[s+"_"+a]||r.bc;if(!l)return o(new Error("missing bc function for "+s));T(e);try{(i=l(t,e.options)).bcinfo&&(i.bcinfo.PLAYER_LOADER=!0)}catch(t){var d="Could not initialize the Brightcove Player.";return e.embedOptions.tagName===u&&(d+=' You are attempting to embed using a "video-js" element. Please ensure that your Player is v6.11.0 or newer in order to support this embed type. Alternatively, pass `"video"` for `embedOptions.tagName`.'),o(new Error(d))}n({type:f,ref:i})},L=function(e,r,n){e.refNode=function(e){return w(e)?e:"string"==typeof e?t.querySelector(e):null}(e.refNode),V(e);var o=e.refNode,i=e.refNodeInsert,a=o.parentNode,s=R(e);if(e.embedType!==y){if(x(e))return F(e,s,r,n);var l=t.createElement("script");l.onload=function(){return F(e,s,r,n)},l.onerror=function(){n(new Error("player script could not be downloaded"))},l.async=!0,l.charset="utf-8",l.src=N(e),i===g?a.appendChild(l):o.appendChild(l)}else r({type:y,ref:s})},z=function(e){var t=o({},c,e),r=t.Promise,n=t.onSuccess,i=t.onFailure;return!M(r)||M(n)||M(i)?L(t,M(n)?n:function(){},M(i)?i:function(e){throw e}):new r(function(e,r){return L(t,e,r)})},J=function(e,t){Object.defineProperty(z,e,{configurable:!1,enumerable:!0,value:t,writable:!1})};J("getBaseUrl",function(){return P()}),J("setBaseUrl",function(e){O(e)}),J("getUrl",function(e){return N(e)}),J("reset",function(){return k()}),[["EMBED_TAG_NAME_VIDEO",p],["EMBED_TAG_NAME_VIDEOJS",u],["EMBED_TYPE_IN_PAGE",f],["EMBED_TYPE_IFRAME",y],["REF_NODE_INSERT_APPEND",h],["REF_NODE_INSERT_PREPEND",m],["REF_NODE_INSERT_BEFORE",v],["REF_NODE_INSERT_AFTER",b],["REF_NODE_INSERT_REPLACE",g],["VERSION","1.8.0"]].forEach(function(e){J(e[0],e[1])});var Y=["catalogSearch","catalogSequence","playlistId","playlistVideoId","videoId"];return function(t){var r,o;function i(e){var r;return(r=t.call(this,e)||this).refNode=null,r.setRefNode=function(e){r.refNode=e},r.loadPlayer=r.loadPlayer.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r.loaded=!1,r}o=t,(r=i).prototype=Object.create(o.prototype),r.prototype.constructor=r,r.__proto__=o;var a=i.prototype;return a.loadPlayer=function(){var e=this;this.disposePlayer();var t=this.props.onSuccess,r=this.props.onFailure,o=n({},this.props,{refNode:this.refNode,refNodeInsert:"append",onSuccess:function(r){var n=r.ref,o=r.type;e.isMounted_?(e.player=n,"in-page"===o&&n.one("dispose",function(){e.player=null}),n.bcinfo&&(n.bcinfo.REACT_PLAYER_LOADER=!0),"function"==typeof t&&t({ref:n,type:o})):e.disposePlayer(n)},onFailure:function(t){if(e.isMounted_){if("function"!=typeof r)throw new Error(t);r(t)}}});delete o.attrs,delete o.baseUrl,delete o.manualReloadFromPropChanges;var i=z.getBaseUrl();this.props.baseUrl&&z.setBaseUrl(this.props.baseUrl),this.loaded||(this.loaded=!0,z(o),z.setBaseUrl(i))},a.disposePlayer=function(){this.player&&(this.player.dispose?this.player.dispose():this.player.parentNode&&this.player.parentNode.removeChild(this.player),this.player=null,this.loaded=!1)},a.findPlaylistVideoIdIndex_=function(e){var t=this.props.playlistVideoId;if(Array.isArray(e)&&t)for(var r=0;r<e.length;r++){var n=e[r],o=n.id,i=n.referenceId;if(o===t||"ref:"+i===t)return r}return-1},a.createPlaybackAPICallback_=function(e,t){var r=this;return function(n,o){if(n)!function(e){e&&console&&console.error&&console.error(e)}(n);else{if("playlist"===e&&t.playlistVideoId){var i=r.findPlaylistVideoIdIndex_(o);i>-1&&(o.startingIndex=i)}r.player.catalog.load(o)}}},a.updatePlayer=function(e){if(this.player&&this.player.el&&this.player.el()){var t;if(this.player.usingPlugin("catalog")){if(e.catalogSequence&&this.props.catalogSequence){var r=this.createPlaybackAPICallback_("sequence",e);return void this.player.catalog.getLazySequence(this.props.catalogSequence,r,this.props.adConfigId)}e.videoId&&this.props.videoId?t={type:"video",id:this.props.videoId}:e.playlistId&&this.props.playlistId?t={type:"playlist",id:this.props.playlistId}:e.catalogSearch&&this.props.catalogSearch&&(t={type:"search",q:this.props.catalogSearch})}if(t){this.props.adConfigId&&(t.adConfigId=this.props.adConfigId),this.props.deliveryConfigId&&(t.deliveryConfigId=this.props.deliveryConfigId);var n=this.createPlaybackAPICallback_(t.type,e);this.player.catalog.get(t,n)}else if(e.playlistVideoId&&this.props.playlistVideoId&&this.player.usingPlugin("playlist")){var o=this.findPlaylistVideoIdIndex_(this.player.playlist());o>-1&&this.player.playlist.currentItem(o)}}},a.componentDidMount=function(){this.isMounted_=!0,this.loadPlayer()},a.componentDidUpdate=function(e){var t=this,r=Object.keys(e).reduce(function(r,n){var o=e[n],i=t.props[n];return"function"==typeof i?r:"object"==typeof i&&null!==i?(JSON.stringify(i)!==JSON.stringify(o)&&(r[n]=!0),r):(i!==o&&(r[n]=!0),r)},{});this.props.manualReloadFromPropChanges||!Object.keys(r).some(function(e){return-1===Y.indexOf(e)})?this.updatePlayer(r):this.loadPlayer()},a.componentWillUnmount=function(){this.isMounted_=!1,this.disposePlayer()},a.render=function(){var t=n({className:"brightcove-react-player-loader"},this.props.attrs,{ref:this.setRefNode});return e.createElement("div",t)},i}(e.Component)});
